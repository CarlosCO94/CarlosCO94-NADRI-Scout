<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Scouting Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .radar-chart { max-width: 500px; margin: 0 auto; }
        .player-card:hover { transform: translateY(-2px); transition: all 0.3s ease; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .best-value { background-color: #dcfce7; color: #166534; font-weight: bold; }
        .comparison-table th { background-color: #f8fafc; font-weight: 600; }
        .player-selector { border: 2px dashed #cbd5e1; border-radius: 8px; padding: 1rem; }
        .player-selector.selected { border-color: #3b82f6; background-color: #eff6ff; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const FootballScoutingApp = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [players, setPlayers] = useState([]);
            const [filteredPlayers, setFilteredPlayers] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [filters, setFilters] = useState({
                position: 'all',
                ageMin: 16,
                ageMax: 40,
                marketValueMin: 0,
                marketValueMax: 100000000
            });
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [csvData, setCsvData] = useState(null);
            
            // Estados para comparaci√≥n
            const [basePlayer, setBasePlayer] = useState(null);
            const [comparisonPlayers, setComparisonPlayers] = useState([]);
            const [comparisonView, setComparisonView] = useState('table'); // 'table' o 'radar'
            
            const radarChartRef = useRef(null);
            const radarChartInstance = useRef(null);

            // Datos de ejemplo mejorados
            const sampleData = [
                {
                    "Player": "Lionel Messi",
                    "Full name": "Lionel Andr√©s Messi Cuccittini",
                    "Team": "Inter Miami",
                    "Position": "RW",
                    "Primary position": "Right Winger",
                    "Age": 36,
                    "Market value": 25000000,
                    "Matches played": 12,
                    "Goals": 11,
                    "Assists": 5,
                    "xG": 8.2,
                    "xA": 4.1,
                    "Duels per 90": 8.5,
                    "Duels won, %": 58.2,
                    "Passes per 90": 52.3,
                    "Accurate passes, %": 87.4,
                    "Dribbles per 90": 4.2,
                    "Successful dribbles, %": 61.8,
                    "Shots per 90": 3.8,
                    "Shots on target, %": 52.6,
                    "Goals per 90": 0.92,
                    "Assists per 90": 0.42,
                    "Birth country": "Argentina",
                    "Height": 170,
                    "Weight": 72
                },
                {
                    "Player": "Erling Haaland",
                    "Full name": "Erling Braut Haaland",
                    "Team": "Manchester City",
                    "Position": "CF",
                    "Primary position": "Centre-Forward",
                    "Age": 24,
                    "Market value": 180000000,
                    "Matches played": 31,
                    "Goals": 27,
                    "Assists": 5,
                    "xG": 24.8,
                    "xA": 3.2,
                    "Duels per 90": 12.1,
                    "Duels won, %": 52.3,
                    "Passes per 90": 21.7,
                    "Accurate passes, %": 78.9,
                    "Shots per 90": 4.8,
                    "Shots on target, %": 58.7,
                    "Dribbles per 90": 1.8,
                    "Successful dribbles, %": 45.2,
                    "Goals per 90": 0.87,
                    "Assists per 90": 0.16,
                    "Birth country": "Norway",
                    "Height": 194,
                    "Weight": 88
                },
                {
                    "Player": "Kylian Mbapp√©",
                    "Full name": "Kylian Mbapp√© Lottin",
                    "Team": "Real Madrid",
                    "Position": "LW",
                    "Primary position": "Left Winger",
                    "Age": 25,
                    "Market value": 200000000,
                    "Matches played": 29,
                    "Goals": 23,
                    "Assists": 8,
                    "xG": 20.1,
                    "xA": 6.8,
                    "Duels per 90": 10.2,
                    "Duels won, %": 55.7,
                    "Passes per 90": 35.6,
                    "Accurate passes, %": 82.1,
                    "Shots per 90": 4.2,
                    "Shots on target, %": 48.3,
                    "Dribbles per 90": 5.1,
                    "Successful dribbles, %": 68.4,
                    "Goals per 90": 0.79,
                    "Assists per 90": 0.28,
                    "Birth country": "France",
                    "Height": 178,
                    "Weight": 73
                },
                {
                    "Player": "Kevin De Bruyne",
                    "Full name": "Kevin De Bruyne",
                    "Team": "Manchester City",
                    "Position": "CM",
                    "Primary position": "Central Midfielder",
                    "Age": 32,
                    "Market value": 90000000,
                    "Matches played": 25,
                    "Goals": 8,
                    "Assists": 18,
                    "xG": 6.8,
                    "xA": 15.2,
                    "Duels per 90": 7.3,
                    "Duels won, %": 49.1,
                    "Passes per 90": 78.4,
                    "Accurate passes, %": 89.7,
                    "Shots per 90": 2.1,
                    "Shots on target, %": 42.1,
                    "Dribbles per 90": 2.3,
                    "Successful dribbles, %": 71.2,
                    "Goals per 90": 0.32,
                    "Assists per 90": 0.72,
                    "Birth country": "Belgium",
                    "Height": 181,
                    "Weight": 76
                },
                {
                    "Player": "Virgil van Dijk",
                    "Full name": "Virgil van Dijk",
                    "Team": "Liverpool",
                    "Position": "CB",
                    "Primary position": "Centre-Back",
                    "Age": 32,
                    "Market value": 65000000,
                    "Matches played": 28,
                    "Goals": 3,
                    "Assists": 2,
                    "xG": 2.8,
                    "xA": 1.4,
                    "Duels per 90": 8.7,
                    "Duels won, %": 67.8,
                    "Passes per 90": 89.2,
                    "Accurate passes, %": 92.1,
                    "Shots per 90": 0.8,
                    "Shots on target, %": 35.7,
                    "Dribbles per 90": 0.9,
                    "Successful dribbles, %": 78.3,
                    "Goals per 90": 0.11,
                    "Assists per 90": 0.07,
                    "Birth country": "Netherlands",
                    "Height": 195,
                    "Weight": 92
                }
            ];

            useEffect(() => {
                if (!csvData) {
                    setPlayers(sampleData);
                    setFilteredPlayers(sampleData);
                }
            }, [csvData]);

            // Manejar carga de CSV
            const handleCSVUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    Papa.parse(file, {
                        complete: (results) => {
                            setCsvData(results.data);
                            const processedData = results.data.slice(1).map((row, index) => {
                                const player = {};
                                results.data[0].forEach((header, i) => {
                                    player[header] = row[i];
                                });
                                return player;
                            }).filter(player => player.Player && player.Player.trim() !== '');
                            
                            setPlayers(processedData);
                            setFilteredPlayers(processedData);
                        },
                        header: false,
                        skipEmptyLines: true
                    });
                }
            };

            // Filtrar jugadores
            useEffect(() => {
                let filtered = players.filter(player => {
                    const matchesSearch = !searchTerm || 
                        player.Player?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        player.Team?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        player["Birth country"]?.toLowerCase().includes(searchTerm.toLowerCase());
                    
                    const matchesPosition = filters.position === 'all' || 
                        player.Position === filters.position;
                    
                    const age = parseInt(player.Age) || 0;
                    const matchesAge = age >= filters.ageMin && age <= filters.ageMax;
                    
                    const marketValue = parseFloat(player["Market value"]) || 0;
                    const matchesValue = marketValue >= filters.marketValueMin && marketValue <= filters.marketValueMax;
                    
                    return matchesSearch && matchesPosition && matchesAge && matchesValue;
                });
                
                setFilteredPlayers(filtered);
            }, [players, searchTerm, filters]);

            // M√©tricas para comparaci√≥n
            const comparisonMetrics = [
                { key: "Goals", label: "Goles", type: "higher" },
                { key: "Assists", label: "Asistencias", type: "higher" },
                { key: "Goals per 90", label: "Goles/90", type: "higher" },
                { key: "Assists per 90", label: "Asistencias/90", type: "higher" },
                { key: "xG", label: "xG", type: "higher" },
                { key: "xA", label: "xA", type: "higher" },
                { key: "Shots per 90", label: "Tiros/90", type: "higher" },
                { key: "Shots on target, %", label: "Tiros al arco %", type: "higher" },
                { key: "Passes per 90", label: "Pases/90", type: "higher" },
                { key: "Accurate passes, %", label: "Precisi√≥n pases %", type: "higher" },
                { key: "Dribbles per 90", label: "Regates/90", type: "higher" },
                { key: "Successful dribbles, %", label: "Regates exitosos %", type: "higher" },
                { key: "Duels per 90", label: "Duelos/90", type: "higher" },
                { key: "Duels won, %", label: "Duelos ganados %", type: "higher" },
                { key: "Market value", label: "Valor mercado (‚Ç¨)", type: "contextual" }
            ];

            // Funci√≥n para determinar el mejor valor
            const getBestValueInRow = (metric, playersToCompare) => {
                const values = playersToCompare.map(player => {
                    const value = parseFloat(player[metric.key]) || 0;
                    return value;
                });
                
                if (metric.type === "higher") {
                    return Math.max(...values);
                } else if (metric.type === "lower") {
                    return Math.min(...values);
                }
                return null;
            };

            // Agregar jugador a comparaci√≥n
            const addToComparison = (player) => {
                if (!basePlayer) {
                    setBasePlayer(player);
                } else if (comparisonPlayers.length < 4 && !comparisonPlayers.find(p => p.Player === player.Player)) {
                    setComparisonPlayers([...comparisonPlayers, player]);
                }
            };

            // Remover jugador de comparaci√≥n
            const removeFromComparison = (playerToRemove) => {
                if (basePlayer && basePlayer.Player === playerToRemove.Player) {
                    setBasePlayer(null);
                    if (comparisonPlayers.length > 0) {
                        setBasePlayer(comparisonPlayers[0]);
                        setComparisonPlayers(comparisonPlayers.slice(1));
                    }
                } else {
                    setComparisonPlayers(comparisonPlayers.filter(p => p.Player !== playerToRemove.Player));
                }
            };

            // Crear gr√°fico radar
            useEffect(() => {
                if (comparisonView === 'radar' && basePlayer && comparisonPlayers.length > 0 && radarChartRef.current) {
                    // Destruir gr√°fico existente
                    if (radarChartInstance.current) {
                        radarChartInstance.current.destroy();
                    }

                    const ctx = radarChartRef.current.getContext('2d');
                    const allPlayers = [basePlayer, ...comparisonPlayers];
                    
                    // M√©tricas para radar (normalizadas)
                    const radarMetrics = [
                        "Goals per 90",
                        "Assists per 90", 
                        "Shots on target, %",
                        "Accurate passes, %",
                        "Successful dribbles, %",
                        "Duels won, %"
                    ];

                    // Normalizar valores para el radar (0-100)
                    const normalizeValue = (value, metric) => {
                        if (metric.includes('%')) {
                            return Math.min(parseFloat(value) || 0, 100);
                        } else if (metric === "Goals per 90") {
                            return Math.min((parseFloat(value) || 0) * 100, 100);
                        } else if (metric === "Assists per 90") {
                            return Math.min((parseFloat(value) || 0) * 100, 100);
                        }
                        return Math.min(parseFloat(value) || 0, 100);
                    };

                    const datasets = allPlayers.map((player, index) => {
                        const colors = [
                            'rgba(59, 130, 246, 0.6)', // Azul para jugador base
                            'rgba(239, 68, 68, 0.6)',  // Rojo
                            'rgba(34, 197, 94, 0.6)',  // Verde
                            'rgba(168, 85, 247, 0.6)', // P√∫rpura
                            'rgba(245, 158, 11, 0.6)'  // Amarillo
                        ];
                        
                        const borderColors = [
                            'rgba(59, 130, 246, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(34, 197, 94, 1)',
                            'rgba(168, 85, 247, 1)',
                            'rgba(245, 158, 11, 1)'
                        ];

                        return {
                            label: player.Player,
                            data: radarMetrics.map(metric => normalizeValue(player[metric], metric)),
                            backgroundColor: colors[index],
                            borderColor: borderColors[index],
                            borderWidth: 2,
                            pointBackgroundColor: borderColors[index],
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        };
                    });

                    radarChartInstance.current = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: radarMetrics.map(metric => {
                                if (metric === "Goals per 90") return "Goles/90";
                                if (metric === "Assists per 90") return "Asist./90";
                                if (metric === "Shots on target, %") return "Tiros al arco";
                                if (metric === "Accurate passes, %") return "Precisi√≥n pases";
                                if (metric === "Successful dribbles, %") return "Regates exitosos";
                                if (metric === "Duels won, %") return "Duelos ganados";
                                return metric;
                            }),
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Comparaci√≥n de Habilidades',
                                    font: {
                                        size: 16,
                                        weight: 'bold'
                                    }
                                },
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 20
                                    }
                                }
                            },
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.1)'
                                    },
                                    angleLines: {
                                        color: 'rgba(0, 0, 0, 0.1)'
                                    },
                                    pointLabels: {
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                return () => {
                    if (radarChartInstance.current) {
                        radarChartInstance.current.destroy();
                    }
                };
            }, [comparisonView, basePlayer, comparisonPlayers]);

            // Estad√≠sticas del dashboard
            const dashboardStats = useMemo(() => {
                if (!players.length) return {};
                
                return {
                    totalPlayers: players.length,
                    avgAge: (players.reduce((sum, p) => sum + (parseInt(p.Age) || 0), 0) / players.length).toFixed(1),
                    totalMarketValue: players.reduce((sum, p) => sum + (parseFloat(p["Market value"]) || 0), 0),
                    topScorer: players.reduce((max, p) => (parseInt(p.Goals) || 0) > (parseInt(max.Goals) || 0) ? p : max, players[0])
                };
            }, [players]);

            // Componente de tarjeta de jugador
            const PlayerCard = ({ player, onClick, showAddButton = false, isSelected = false }) => (
                <div className={`player-card bg-white rounded-lg shadow-md p-4 cursor-pointer border-l-4 border-blue-500 hover:shadow-lg ${isSelected ? 'ring-2 ring-blue-500' : ''}`}>
                    <div className="flex justify-between items-start mb-3">
                        <div onClick={() => onClick(player)} className="flex-1">
                            <h3 className="font-bold text-lg text-gray-800">{player.Player}</h3>
                            <p className="text-gray-600 text-sm">{player.Team}</p>
                        </div>
                        <div className="flex flex-col items-end gap-2">
                            <span className="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                                {player.Position}
                            </span>
                            {showAddButton && (
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        addToComparison(player);
                                    }}
                                    className="bg-green-500 hover:bg-green-600 text-white text-xs px-2 py-1 rounded"
                                >
                                    + Comparar
                                </button>
                            )}
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span className="text-gray-500">Edad:</span>
                            <span className="ml-1 font-medium">{player.Age}</span>
                        </div>
                        <div>
                            <span className="text-gray-500">Pa√≠s:</span>
                            <span className="ml-1 font-medium">{player["Birth country"]}</span>
                        </div>
                        <div>
                            <span className="text-gray-500">Goles:</span>
                            <span className="ml-1 font-medium text-green-600">{player.Goals || 0}</span>
                        </div>
                        <div>
                            <span className="text-gray-500">Asistencias:</span>
                            <span className="ml-1 font-medium text-blue-600">{player.Assists || 0}</span>
                        </div>
                    </div>
                    
                    <div className="mt-3 pt-3 border-t">
                        <div className="text-sm text-gray-600">
                            <span>Valor de mercado: </span>
                            <span className="font-bold text-green-600">
                                ‚Ç¨{(parseFloat(player["Market value"]) || 0).toLocaleString()}
                            </span>
                        </div>
                    </div>
                </div>
            );

            // Componente de perfil detallado del jugador
            const PlayerProfile = ({ player, onBack }) => (
                <div className="bg-white rounded-lg shadow-lg">
                    <div className="gradient-bg text-white p-6 rounded-t-lg">
                        <button 
                            onClick={onBack}
                            className="mb-4 bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded text-sm"
                        >
                            ‚Üê Volver
                        </button>
                        <div className="flex items-center gap-4">
                            <div className="w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-2xl font-bold">
                                {player.Player?.charAt(0)}
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold">{player.Player}</h1>
                                <p className="text-lg opacity-90">{player["Full name"]}</p>
                                <p className="opacity-75">{player.Team} ‚Ä¢ {player.Position}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div className="p-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="stat-card p-4 rounded-lg">
                                <h3 className="font-bold text-lg mb-3 text-gray-800">Informaci√≥n Personal</h3>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Edad:</span>
                                        <span className="font-medium">{player.Age} a√±os</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Pa√≠s:</span>
                                        <span className="font-medium">{player["Birth country"]}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Altura:</span>
                                        <span className="font-medium">{player.Height} cm</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Peso:</span>
                                        <span className="font-medium">{player.Weight} kg</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="stat-card p-4 rounded-lg">
                                <h3 className="font-bold text-lg mb-3 text-gray-800">Rendimiento</h3>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Partidos:</span>
                                        <span className="font-medium">{player["Matches played"] || 0}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Goles:</span>
                                        <span className="font-medium text-green-600">{player.Goals || 0}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Asistencias:</span>
                                        <span className="font-medium text-blue-600">{player.Assists || 0}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">xG:</span>
                                        <span className="font-medium">{player.xG || 0}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="stat-card p-4 rounded-lg">
                                <h3 className="font-bold text-lg mb-3 text-gray-800">Habilidades</h3>
                                <div className="space-y-2 text-sm">
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Precisi√≥n pases:</span>
                                        <span className="font-medium">{player["Accurate passes, %"] || 0}%</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Duelos ganados:</span>
                                        <span className="font-medium">{player["Duels won, %"] || 0}%</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Regates exitosos:</span>
                                        <span className="font-medium">{player["Successful dribbles, %"] || 0}%</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-gray-600">Valor mercado:</span>
                                        <span className="font-medium text-green-600">
                                            ‚Ç¨{(parseFloat(player["Market value"]) || 0).toLocaleString()}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="gradient-bg text-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <h1 className="text-3xl font-bold">Football Scouting Pro</h1>
                            <p className="text-lg opacity-90">Sistema avanzado de an√°lisis de jugadores</p>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="flex space-x-8">
                                {[
                                    { id: 'dashboard', label: 'Dashboard', icon: 'üìä' },
                                    { id: 'players', label: 'Jugadores', icon: 'üë•' },
                                    { id: 'comparison', label: 'Comparador', icon: '‚öñÔ∏è' },
                                    { id: 'analysis', label: 'An√°lisis', icon: 'üìà' },
                                    { id: 'upload', label: 'Cargar Datos', icon: 'üìÅ' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`py-4 px-2 border-b-2 font-medium text-sm ${
                                            activeTab === tab.id
                                                ? 'border-blue-500 text-blue-600'
                                                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                                        }`}
                                    >
                                        <span className="mr-2">{tab.icon}</span>
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    {/* Content */}
                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {activeTab === 'dashboard' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Dashboard</h2>
                                
                                {/* Stats Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                    <div className="stat-card p-6 rounded-lg">
                                        <div className="flex items-center">
                                            <div className="p-2 bg-blue-100 rounded-lg">
                                                <span className="text-2xl">üë•</span>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-gray-600 text-sm">Total Jugadores</p>
                                                <p className="text-2xl font-bold text-gray-800">{dashboardStats.totalPlayers}</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="stat-card p-6 rounded-lg">
                                        <div className="flex items-center">
                                            <div className="p-2 bg-green-100 rounded-lg">
                                                <span className="text-2xl">üìä</span>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-gray-600 text-sm">Edad Promedio</p>
                                                <p className="text-2xl font-bold text-gray-800">{dashboardStats.avgAge}</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="stat-card p-6 rounded-lg">
                                        <div className="flex items-center">
                                            <div className="p-2 bg-yellow-100 rounded-lg">
                                                <span className="text-2xl">üí∞</span>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-gray-600 text-sm">Valor Total</p>
                                                <p className="text-2xl font-bold text-gray-800">
                                                    ‚Ç¨{(dashboardStats.totalMarketValue / 1000000).toFixed(1)}M
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="stat-card p-6 rounded-lg">
                                        <div className="flex items-center">
                                            <div className="p-2 bg-red-100 rounded-lg">
                                                <span className="text-2xl">‚öΩ</span>
                                            </div>
                                            <div className="ml-4">
                                                <p className="text-gray-600 text-sm">Top Goleador</p>
                                                <p className="text-lg font-bold text-gray-800">
                                                    {dashboardStats.topScorer?.Player?.substring(0, 10)}...
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'players' && !selectedPlayer && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Jugadores</h2>
                                    <div className="text-sm text-gray-600">
                                        {filteredPlayers.length} de {players.length} jugadores
                                    </div>
                                </div>
                                
                                {/* Filters */}
                                <div className="bg-white p-6 rounded-lg shadow-sm mb-6">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <input
                                            type="text"
                                            placeholder="Buscar jugador, equipo o pa√≠s..."
                                            className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                        
                                        <select
                                            className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            value={filters.position}
                                            onChange={(e) => setFilters({...filters, position: e.target.value})}
                                        >
                                            <option value="all">Todas las posiciones</option>
                                            <option value="GK">Portero</option>
                                            <option value="CB">Defensa Central</option>
                                            <option value="LB">Lateral Izquierdo</option>
                                            <option value="RB">Lateral Derecho</option>
                                            <option value="CM">Centrocampista</option>
                                            <option value="LW">Extremo Izquierdo</option>
                                            <option value="RW">Extremo Derecho</option>
                                            <option value="CF">Delantero Centro</option>
                                        </select>
                                        
                                        <div className="flex gap-2">
                                            <input
                                                type="number"
                                                placeholder="Edad min"
                                                className="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-20"
                                                value={filters.ageMin}
                                                onChange={(e) => setFilters({...filters, ageMin: parseInt(e.target.value) || 16})}
                                            />
                                            <input
                                                type="number"
                                                placeholder="Edad max"
                                                className="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-20"
                                                value={filters.ageMax}
                                                onChange={(e) => setFilters({...filters, ageMax: parseInt(e.target.value) || 40})}
                                            />
                                        </div>
                                        
                                        <button
                                            onClick={() => {
                                                setSearchTerm('');
                                                setFilters({
                                                    position: 'all',
                                                    ageMin: 16,
                                                    ageMax: 40,
                                                    marketValueMin: 0,
                                                    marketValueMax: 100000000
                                                });
                                            }}
                                            className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                                        >
                                            Limpiar Filtros
                                        </button>
                                    </div>
                                </div>
                                
                                {/* Players Grid */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {filteredPlayers.map((player, index) => (
                                        <PlayerCard
                                            key={index}
                                            player={player}
                                            onClick={setSelectedPlayer}
                                            showAddButton={true}
                                        />
                                    ))}
                                </div>
                                
                                {filteredPlayers.length === 0 && (
                                    <div className="text-center py-12">
                                        <p className="text-gray-500 text-lg">No se encontraron jugadores con los filtros aplicados</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'players' && selectedPlayer && (
                            <PlayerProfile 
                                player={selectedPlayer}
                                onBack={() => setSelectedPlayer(null)}
                            />
                        )}

                        {/* NUEVA SECCI√ìN: COMPARADOR DE JUGADORES */}
                        {activeTab === 'comparison' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Comparador de Jugadores</h2>
                                
                                {/* Panel de selecci√≥n de jugadores */}
                                <div className="bg-white p-6 rounded-lg shadow-sm mb-6">
                                    <h3 className="text-lg font-semibold mb-4">Seleccionar Jugadores para Comparar</h3>
                                    
                                    {/* Jugador base */}
                                    <div className="mb-6">
                                        <h4 className="font-medium text-gray-700 mb-3">Jugador Base</h4>
                                        <div className={`player-selector ${basePlayer ? 'selected' : ''}`}>
                                            {basePlayer ? (
                                                <div className="flex items-center justify-between">
                                                    <div>
                                                        <span className="font-medium">{basePlayer.Player}</span>
                                                        <span className="text-gray-500 ml-2">({basePlayer.Team})</span>
                                                    </div>
                                                    <button
                                                        onClick={() => removeFromComparison(basePlayer)}
                                                        className="text-red-500 hover:text-red-700"
                                                    >
                                                        ‚úï
                                                    </button>
                                                </div>
                                            ) : (
                                                <p className="text-gray-500 text-center">Selecciona un jugador base desde la lista</p>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* Jugadores para comparar */}
                                    <div className="mb-6">
                                        <h4 className="font-medium text-gray-700 mb-3">Jugadores a Comparar ({comparisonPlayers.length}/4)</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                            {[...Array(4)].map((_, index) => {
                                                const player = comparisonPlayers[index];
                                                return (
                                                    <div key={index} className={`player-selector ${player ? 'selected' : ''}`}>
                                                        {player ? (
                                                            <div className="flex items-center justify-between">
                                                                <div>
                                                                    <div className="font-medium text-sm">{player.Player}</div>
                                                                    <div className="text-gray-500 text-xs">({player.Team})</div>
                                                                </div>
                                                                <button
                                                                    onClick={() => removeFromComparison(player)}
                                                                    className="text-red-500 hover:text-red-700"
                                                                >
                                                                    ‚úï
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            <p className="text-gray-500 text-center text-sm">
                                                                Jugador {index + 1}
                                                            </p>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                    
                                    {/* Botones de acci√≥n */}
                                    <div className="flex gap-4">
                                        <button
                                            onClick={() => {
                                                setBasePlayer(null);
                                                setComparisonPlayers([]);
                                            }}
                                            className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                                        >
                                            Limpiar Todo
                                        </button>
                                        {basePlayer && comparisonPlayers.length > 0 && (
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => setComparisonView('table')}
                                                    className={`px-4 py-2 rounded-lg ${comparisonView === 'table' ? 'bg-blue-500 text-white' : 'bg-blue-100 text-blue-800'}`}
                                                >
                                                    üìä Vista Tabla
                                                </button>
                                                <button
                                                    onClick={() => setComparisonView('radar')}
                                                    className={`px-4 py-2 rounded-lg ${comparisonView === 'radar' ? 'bg-blue-500 text-white' : 'bg-blue-100 text-blue-800'}`}
                                                >
                                                    üï∏Ô∏è Vista Radar
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {/* Lista de jugadores disponibles */}
                                <div className="bg-white p-6 rounded-lg shadow-sm mb-6">
                                    <h3 className="text-lg font-semibold mb-4">Jugadores Disponibles</h3>
                                    <div className="mb-4">
                                        <input
                                            type="text"
                                            placeholder="Buscar jugador..."
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                                        {filteredPlayers.map((player, index) => {
                                            const isSelected = basePlayer?.Player === player.Player || 
                                                             comparisonPlayers.some(p => p.Player === player.Player);
                                            const canAdd = !basePlayer || comparisonPlayers.length < 4;
                                            
                                            return (
                                                <div key={index} className={`p-3 border rounded-lg cursor-pointer hover:bg-gray-50 ${isSelected ? 'bg-blue-50 border-blue-300' : ''}`}>
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <div className="font-medium">{player.Player}</div>
                                                            <div className="text-sm text-gray-500">{player.Team} ‚Ä¢ {player.Position}</div>
                                                        </div>
                                                        {!isSelected && canAdd && (
                                                            <button
                                                                onClick={() => addToComparison(player)}
                                                                className="bg-green-500 hover:bg-green-600 text-white text-xs px-2 py-1 rounded"
                                                            >
                                                                + Agregar
                                                            </button>
                                                        )}
                                                        {isSelected && (
                                                            <span className="text-green-600 text-sm">‚úì Seleccionado</span>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                                
                                {/* Comparaci√≥n - Vista Tabla */}
                                {basePlayer && comparisonPlayers.length > 0 && comparisonView === 'table' && (
                                    <div className="bg-white p-6 rounded-lg shadow-sm">
                                        <h3 className="text-lg font-semibold mb-4">Comparaci√≥n Detallada</h3>
                                        <div className="overflow-x-auto">
                                            <table className="w-full comparison-table">
                                                <thead>
                                                    <tr>
                                                        <th className="text-left p-3 border-b">M√©trica</th>
                                                        <th className="text-center p-3 border-b bg-blue-50">{basePlayer.Player} (Base)</th>
                                                        {comparisonPlayers.map((player, index) => (
                                                            <th key={index} className="text-center p-3 border-b">{player.Player}</th>
                                                        ))}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {comparisonMetrics.map((metric, index) => {
                                                        const allPlayers = [basePlayer, ...comparisonPlayers];
                                                        const bestValue = getBestValueInRow(metric, allPlayers);
                                                        
                                                        return (
                                                            <tr key={index} className={index % 2 === 0 ? 'bg-gray-50' : ''}>
                                                                <td className="p-3 border-b font-medium">{metric.label}</td>
                                                                {allPlayers.map((player, playerIndex) => {
                                                                    const value = parseFloat(player[metric.key]) || 0;
                                                                    const isBase = playerIndex === 0;
                                                                    const isBest = value === bestValue && metric.type !== 'contextual';
                                                                    const displayValue = metric.key === "Market value" 
                                                                        ? `‚Ç¨${value.toLocaleString()}`
                                                                        : metric.key.includes('%') 
                                                                        ? `${value}%` 
                                                                        : value.toFixed(2);
                                                                    
                                                                    return (
                                                                        <td 
                                                                            key={playerIndex} 
                                                                            className={`p-3 border-b text-center ${
                                                                                isBase ? 'bg-blue-50' : ''
                                                                            } ${isBest ? 'best-value' : ''}`}
                                                                        >
                                                                            {displayValue}
                                                                        </td>
                                                                    );
                                                                })}
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                                            <p className="text-sm text-yellow-800">
                                                <strong>üí° Leyenda:</strong> Los valores resaltados en verde representan el mejor valor en cada m√©trica.
                                                El jugador base est√° destacado en azul.
                                            </p>
                                        </div>
                                    </div>
                                )}
                                
                                {/* Comparaci√≥n - Vista Radar */}
                                {basePlayer && comparisonPlayers.length > 0 && comparisonView === 'radar' && (
                                    <div className="bg-white p-6 rounded-lg shadow-sm">
                                        <h3 className="text-lg font-semibold mb-4">Comparaci√≥n Visual (Radar)</h3>
                                        <div className="radar-chart">
                                            <canvas ref={radarChartRef} width="400" height="400"></canvas>
                                        </div>
                                        <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded">
                                            <p className="text-sm text-blue-800">
                                                <strong>üìä Nota:</strong> El gr√°fico radar muestra las habilidades clave normalizadas a una escala de 0-100.
                                                Cuanto m√°s grande el √°rea, mejor el rendimiento general del jugador.
                                            </p>
                                        </div>
                                    </div>
                                )}
                                
                                {/* Estado vac√≠o */}
                                {(!basePlayer || comparisonPlayers.length === 0) && (
                                    <div className="bg-white p-12 rounded-lg shadow-sm text-center">
                                        <div className="text-6xl mb-4">‚öñÔ∏è</div>
                                        <h3 className="text-xl font-semibold text-gray-800 mb-2">Comparador de Jugadores</h3>
                                        <p className="text-gray-600 mb-4">
                                            Selecciona un jugador base y hasta 4 jugadores para comparar sus estad√≠sticas
                                        </p>
                                        <div className="text-sm text-gray-500">
                                            <p>1. Selecciona un jugador base</p>
                                            <p>2. Agrega hasta 4 jugadores para comparar</p>
                                            <p>3. Ve la comparaci√≥n en tabla o gr√°fico radar</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'analysis' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">An√°lisis Avanzado</h2>
                                <div className="bg-white p-8 rounded-lg shadow-sm text-center">
                                    <p className="text-gray-600 mb-4">Esta secci√≥n incluir√°:</p>
                                    <ul className="text-left max-w-md mx-auto space-y-2 text-gray-700">
                                        <li>‚Ä¢ An√°lisis de rendimiento por posici√≥n</li>
                                        <li>‚Ä¢ Predicciones de valor de mercado</li>
                                        <li>‚Ä¢ Reportes de scouting automatizados</li>
                                        <li>‚Ä¢ Tendencias de mercado</li>
                                        <li>‚Ä¢ An√°lisis de riesgo/beneficio</li>
                                    </ul>
                                </div>
                            </div>
                        )}

                        {activeTab === 'upload' && (
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Cargar Datos CSV</h2>
                                <div className="bg-white p-8 rounded-lg shadow-sm">
                                    <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors">
                                        <input
                                            type="file"
                                            accept=".csv"
                                            onChange={handleCSVUpload}
                                            className="hidden"
                                            id="csv-upload"
                                        />
                                        <label htmlFor="csv-upload" className="cursor-pointer">
                                            <div className="text-6xl mb-4">üìÅ</div>
                                            <p className="text-xl font-medium text-gray-700 mb-2">
                                                Arrastra tu archivo CSV aqu√≠ o haz clic para seleccionar
                                            </p>
                                            <p className="text-gray-500">
                                                Archivo compatible con columnas de Wyscout
                                            </p>
                                        </label>
                                    </div>
                                    
                                    {csvData && (
                                        <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                                            <p className="text-green-800 font-medium">
                                                ‚úÖ Archivo cargado exitosamente: {players.length} jugadores encontrados
                                            </p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        // Renderizar la aplicaci√≥n
        ReactDOM.render(<FootballScoutingApp />, document.getElementById('root'));
    </script>
</body>
</html>
